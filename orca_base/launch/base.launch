<launch>

  <arg name="simulation" default="true" />

  <!-- Filepath for the robot description file; can be overridden -->
  <arg name="model" default="$(find orca_description)/urdf/orca.urdf.xacro" />

  <!-- Open the URDF, run the xacro preprocessor, and stuff the result into 'robot_description' on the parameter server -->
  <param name="robot_description" command="$(find xacro)/xacro --inorder $(arg model)" />

  <!-- Launch some state publishers -->
  <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher" output="log" />
  <node name="robot_state_publisher" pkg="robot_state_publisher" type="robot_state_publisher" output="log" />

  <!-- Launch orca_base -->
  <node name="orca_base" pkg="orca_base" type="orca_base" output="log">
    <param name="simulation" value="$(arg simulation)" />
    <param name="effort_dead_band" value="0.0001" />
  </node>

  <!-- Launch the yaw pid controller -->
  <node name="yaw_pid" pkg="pid" type="controller" output="log">
    <param name="node_name" value="yaw_pid_node" />
    <param name="angle_error" value="true" /> <!-- Treat control variable as an angle in radians -->
    <param name="Kp" value="0.1" />
    <param name="Ki" value="0.0" />
    <param name="Kd" value="0.0" />
    <param name="upper_limit" value="0.2" />
    <param name="lower_limit" value="-0.2" />
    <remap from="pid_enable" to="/yaw_pid/pid_enable" />
    <remap from="state" to="/yaw_pid/state" />
    <remap from="setpoint" to="/yaw_pid/setpoint" />
    <remap from="control_effort" to="/yaw_pid/control_effort" />
  </node>

  <!-- Launch the depth pid controller -->
  <node name="depth_pid" pkg="pid" type="controller" output="log">
    <param name="node_name" value="depth_pid_node"/>
    <param name="Kp" value="0.1" />
    <param name="Ki" value="0.03" />
    <param name="Kd" value="0.1" />
    <param name="upper_limit" value="0.2" />
    <param name="lower_limit" value="-0.2" />
    <remap from="pid_enable" to="/depth_pid/pid_enable" />
    <remap from="state" to="/depth_pid/state" />
    <remap from="setpoint" to="/depth_pid/setpoint" />
    <remap from="control_effort" to="/depth_pid/control_effort" />
  </node>

</launch>
